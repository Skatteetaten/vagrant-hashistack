---
- hosts: all
  become: yes
  tasks:
    - name: Check if .env_override is provided
      debug:
        msg: "Checking if env_override process was successful. Doing nothing if this is a local test"
      #failed_when: local_test is undefined and not lookup( 'env', 'TF_VAR_env_override') | bool
      tags: test

    - name: Debug all env vars
      debug:
        var: ansible_env

    - name: Debug ansible local vars
      debug:
        var: ansible_local

    - name: Start minio
      systemd: name=minio state=started

    - name: Set variables
      set_fact:
        consul_http_addr: "http://127.0.0.1:8500"
        consul_master_token: "master"
        vault_master_token: "master"

    - name: Configure and start hashistack services
      include_role:
        name: service_bootstrap
      vars:
        service: "{{ item }}"
      loop: "{{ hashicorp.daemons }}"